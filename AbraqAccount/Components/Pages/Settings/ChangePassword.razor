@page "/settings/change-password"
@using System.ComponentModel.DataAnnotations
@inject NavigationManager Navigation

<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-5">
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <h3 class="mb-0">Change Password</h3>
                </div>
                <div class="card-body">
                    @if (!string.IsNullOrEmpty(statusMessage))
                    {
                        <div class="alert @(isError ? "alert-danger" : "alert-success")">@statusMessage</div>
                    }

                    <EditForm Model="model" OnValidSubmit="HandleSubmit">
                        <DataAnnotationsValidator />

                        <div class="mb-3">
                            <label class="form-label">Current Password</label>
                            <input type="password" @bind="model.CurrentPassword" class="form-control" />
                            <ValidationMessage For="@(() => model.CurrentPassword)" />
                        </div>

                        <hr />

                        <div class="mb-3">
                            <label class="form-label">New Password</label>
                            <input type="password" @bind="model.NewPassword" class="form-control" />
                            <ValidationMessage For="@(() => model.NewPassword)" />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Confirm New Password</label>
                            <input type="password" @bind="model.ConfirmPassword" class="form-control" />
                            <ValidationMessage For="@(() => model.ConfirmPassword)" />
                        </div>

                        <div class="d-flex justify-content-between mt-4">
                            <button type="button" class="btn btn-secondary" @onclick="Cancel">Cancel</button>
                            <button type="submit" class="btn btn-primary" disabled="@isSubmitting">
                                @if (isSubmitting)
                                {
                                    <span class="spinner-border spinner-border-sm" role="status"></span>
                                }
                                Update Password
                            </button>
                        </div>
                    </EditForm>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private PasswordModel model = new();
    private bool isSubmitting;
    private string? statusMessage;
    private bool isError;

    private async Task HandleSubmit()
    {
        isSubmitting = true;
        statusMessage = null;

        // Simulate logic
        await Task.Delay(1000);
        
        statusMessage = "Password updated successfully!";
        isError = false;
        
        isSubmitting = false;
        await Task.Delay(2000);
        Navigation.NavigateTo("/settings/profile");
    }

    private void Cancel() => Navigation.NavigateTo("/settings/profile");

    public class PasswordModel
    {
        [Required]
        public string CurrentPassword { get; set; } = string.Empty;

        [Required]
        [MinLength(6, ErrorMessage = "New password must be at least 6 characters.")]
        public string NewPassword { get; set; } = string.Empty;

        [Required]
        [Compare(nameof(NewPassword), ErrorMessage = "Passwords do not match.")]
        public string ConfirmPassword { get; set; } = string.Empty;
    }
}
